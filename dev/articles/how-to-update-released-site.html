<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="pkgdown">
<title>How to update a released site ‚Ä¢ pkgdown</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to update a released site">
<meta property="og:description" content="pkgdown">
<meta property="og:image" content="https://pkgdown.r-lib.org/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="pkgdown.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">pkgdown</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.7.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/customise.html">Customise your site</a>
    <a class="dropdown-item" href="../articles/linking.html">Auto-linking</a>
    <a class="dropdown-item" href="../articles/search.html">Search</a>
    <a class="dropdown-item" href="../articles/metadata.html">Metadata</a>
    <a class="dropdown-item" href="../articles/how-to-update-released-site.html">How to update a released site</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/12/pkgdown-2-0-0/">Version 2.0.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/09/pkgdown-1-6-0/">Version 1.6.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/03/pkgdown-1-5-0/">Version 1.5.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/09/pkgdown-1-4-0/">Version 1.4.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/12/pkgdown-1-3-0/">Version 1.3.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/06/pkgdown-1-1-0/">Version 1.1.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/05/pkgdown-1-0-0/">Version 1.0.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/pkgdown/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>How to update a released site</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/pkgdown/blob/HEAD/vignettes/how-to-update-released-site.Rmd" class="external-link"><code>vignettes/how-to-update-released-site.Rmd</code></a></small>
      <div class="d-none name"><code>how-to-update-released-site.Rmd</code></div>
    </div>

    
    
<p>This vignette shows you how to update the released version of your
site to match the dev version of the site, so the first step is to
ensure that the dev site looks the way that you want it.</p>
<div class="section level2">
<h2 id="process">Process<a class="anchor" aria-label="anchor" href="#process"></a>
</h2>
<p>If you‚Äôre up to speed with the basic idea and just want some code to
follow here it us. Otherwise, read more below.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>First, make sure you‚Äôre in the <code>main</code> branch, and you have
the latest version:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gert</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/gert/reference/git_branch.html" class="external-link">git_branch_checkout</a></span><span class="op">(</span><span class="st">"main"</span><span class="op">)</span></span>
<span><span class="fu">gert</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/gert/reference/git_fetch.html" class="external-link">git_pull</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Next figure out the released version that we‚Äôre updating:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ver</span> <span class="op">&lt;-</span> <span class="fu">desc</span><span class="fu">::</span><span class="fu"><a href="https://desc.r-lib.org/reference/desc_get_version.html" class="external-link">desc_get_version</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<p>We‚Äôll use this to create and checkout the branch that you‚Äôll work
in:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gert</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/gert/reference/git_branch.html" class="external-link">git_branch_create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"pkgdown-v"</span>, <span class="va">ver</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"v"</span>, <span class="va">ver</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="backport-changes">Backport changes<a class="anchor" aria-label="anchor" href="#backport-changes"></a>
</h3>
<p>Now you need to backport changes from the dev site into this branch.
Run this R code to generate the git code to pull changes for the most
common locations:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># overall site config </span></span>
<span>  <span class="st">"_pkgdown.yml"</span>,</span>
<span>  <span class="co"># the workflow that builds the site</span></span>
<span>  <span class="st">".github/workflows/pkgdown.yaml"</span>,</span>
<span>  <span class="co"># readme and vignettes</span></span>
<span>  <span class="st">"README.md"</span>, <span class="st">"vignettes"</span>,</span>
<span>  <span class="co"># logo and favicon</span></span>
<span>  <span class="st">"man/figures/"</span>, <span class="st">"pkgdown/"</span>, </span>
<span>  <span class="co"># Author metadata and Config/Needs/Website</span></span>
<span>  <span class="st">"DESCRIPTION"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"git checkout v{ver} -- {files}"</span><span class="op">)</span></span></code></pre></div>
<p>If you backport <code>DESCRIPTION</code>, you‚Äôll also need undo the
change to the <code>Version</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">desc</span><span class="fu">::</span><span class="fu"><a href="https://desc.r-lib.org/reference/desc_set_version.html" class="external-link">desc_set_version</a></span><span class="op">(</span><span class="va">ver</span><span class="op">)</span></span></code></pre></div>
<p>Now build the site locally and check that it looks as you expect:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="../reference/build_site.html">build_site</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="publish">Publish<a class="anchor" aria-label="anchor" href="#publish"></a>
</h3>
<p>Now you need to publish the site. First push your branch to
GitHub:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">:::</span><span class="fu">git_push_first</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then trigger the pkgdown workflow:</p>
<ol style="list-style-type: decimal">
<li>Go to your package‚Äôs GHA page, e.g.¬†with
<code>usethis::browse_github_actions())</code>.</li>
<li>Select the pkgdown workflow.</li>
<li>Click <em>Run workflow</em> and select the branch you just
pushed.</li>
</ol>
<p>If there‚Äôs no dropdown menu for this, that means your pkgdown
workflow config is not current.</p>
</div>
</div>
<div class="section level2">
<h2 id="context">Context<a class="anchor" aria-label="anchor" href="#context"></a>
</h2>
<p>Before we talk about <strong>how</strong> to update a released site,
we first establish <strong>why</strong> you might need to do this. What
is a released site? What other kind of pkgdown site could you have? Why
does updating a released site take special effort?</p>
<div class="section level3">
<h3 id="automatic-development-mode">Automatic development mode<a class="anchor" aria-label="anchor" href="#automatic-development-mode"></a>
</h3>
<p>Every pkgdown site has a so-called <a href="https://pkgdown.r-lib.org/reference/build_site.html#development-mode"><em>development
mode</em></a>, which can be specified via the <code>development</code>
field in <code>_pkgdown.yml</code>. If unspecified, the default is
<code>mode: release</code>, which results in a single pkgdown site.
Despite the name, this single site reflects ‚Äúthe current package state‚Äù,
which could be either a released state or a development state.</p>
<p>For packages with a substantial user base, it is recommended instead
to specify <code>mode: auto</code> like so:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">development</span><span class="kw">:</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="at">  </span><span class="fu">mode</span><span class="kw">:</span><span class="at"> auto</span></span></code></pre></div>
<p>This directs pkgdown to ‚Äúgenerate different sites for the development
and released versions of your package.‚Äù</p>
<p>The readr package demonstrates what happens in automatic development
mode:</p>
<p><a href="https://readr.tidyverse.org" class="external-link">readr.tidyverse.org</a>
documents the released version, i.e.¬†what
<code><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages()</a></code> would deliver.<br><a href="https://readr.tidyverse.org/dev/" class="external-link">readr.tidyverse.org/dev/</a>
documents the dev version, i.e.¬†what you‚Äôd get by installing from
GitHub.</p>
<p>In this mode, <code><a href="../reference/build_site.html">pkgdown::build_site()</a></code>, consults
DESCRIPTION to learn the package‚Äôs version number. For a development
version number, the rendered site is written to <code>docs/dev/</code>.
For a released version number, the site is written to
<code>docs/</code>. (There are also other signals to alert users that
they are reading documentation for a dev version vs.¬†a released
version.)</p>
<p>Automatic development mode is recommended for packages with a broad
user base, because it maximizes the chance that a user will read
web-based documentation that reflects the package version that is
locally installed.</p>
</div>
<div class="section level3">
<h3 id="publishing">Publishing<a class="anchor" aria-label="anchor" href="#publishing"></a>
</h3>
<p>Now that we‚Äôve established the meaning of a released (vs dev) site,
we have to consider how the site gets rendered and deployed.</p>
<p>Many people use <code><a href="https://usethis.r-lib.org/reference/use_pkgdown.html" class="external-link">usethis::use_pkgdown_github_pages()</a></code> to
do basic pkgdown setup and configure a GitHub Actions (GHA) workflow to
automatically render and publish the site to GitHub Pages. Here‚Äôs an
overview of what this function does:</p>
<pre><code>usethis::use_pkgdown_github_pages() =
  use_pkgdown() +
  use_github_pages() + 
  use_github_action("pkgdown") +
  add the pkgdown site's URL to _pkgdown.yml, URL field of DESCRIPTION,
    and to the GitHub repo +
  (if owning org is one of: tidyverse, r-lib, tidymodels, rstudio) 
  add "tidyverse/tidytemplate" to Config/Needs/website in DESCRIPTION</code></pre>
<p>As a result, the publishing cadence of many pkgdown sites is governed
by the workflow maintained at <a href="https://github.com/r-lib/actions/blob/v2/examples/pkgdown.yaml" class="external-link"><code>r-lib/actions/examples/pkgdown.yaml</code></a>.
(Do not confuse <code>_pkgdown.yml</code>, which gives instructions to
the pkgdown package, with <code>.github/workflows/pkgdown.yaml</code>,
which gives instructions to GHA.)</p>
<p>Here are some of the most important bits of the GHA workflow
config:</p>
<p><em>NOTE: this is from v2 of <code>r-lib/actions</code>, which is
important! If you use usethis to add/update workflow config, make sure
you‚Äôre using the dev version of usethis, which will pull from the
<code>v2</code> tag.</em></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">main</span><span class="kw">,</span><span class="at"> master</span><span class="kw">]</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">main</span><span class="kw">,</span><span class="at"> master</span><span class="kw">]</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="at">  </span><span class="fu">release</span><span class="kw">:</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="at">    </span><span class="fu">types</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">published</span><span class="kw">]</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="at">&lt;snip, snip&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build site</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> Rscript -e 'pkgdown::build_site_github_pages(...)'</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Deploy to GitHub pages üöÄ</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> JamesIves/github-pages-deploy-action@4.1.4</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="at">        &lt;snip, snip&gt;</span></span></code></pre></div>
<p>We build and deploy for pushes to <code>main</code> (or
<code>master</code>).<br>
We build for pull requests against <code>main</code> (or
<code>master</code>).<br>
But we don‚Äôt deploy for pull requests.</p>
<p>We build and deploy when we publish a GitHub release.<br>
By convention, we assume that a GitHub release coincides with a CRAN
release.<br><strong>This is the primary mechanism for building the released pkgdown
site.</strong></p>
<p><code><a href="../reference/build_site_github_pages.html">pkgdown::build_site_github_pages()</a></code> consults the version
in DESCRIPTION to detect whether it‚Äôs building from a released version
or a dev version. That determines the <code>dest_dir</code>,
e.g.¬†<code>docs/</code> for released and <code>docs/dev/</code> for dev.
For a package in automatic development mode, this means that almost all
of your pushes trigger an update to the dev site. The released site is
only updated when you push a state with a non-development version number
or when you publish a GitHub release.</p>
<p>So how do you tweak things about the released site <em>in
between</em> releases?</p>
<p>That brings us to <code>workflow_dispatch:</code>. (Yes that dangling
colon is correct.)</p>
<p>The inclusion of <code>workflow_dispatch</code> as a trigger means
the pkgdown workflow can be run on demand, either manually from the
browser or via the GitHub REST API. We‚Äôre going to show how to update a
released site from a GitHub branch or tag, using the browser method. In
the future, we might build some tooling around the API method.</p>
<p>Places to learn more about triggering GHA workflows:</p>
<ul>
<li><a href="https://docs.github.com/en/actions/learn-github-actions/events-that-trigger-workflows#workflow_dispatch" class="external-link uri">https://docs.github.com/en/actions/learn-github-actions/events-that-trigger-workflows#workflow_dispatch</a></li>
<li><a href="https://docs.github.com/en/actions/managing-workflow-runs/manually-running-a-workflow" class="external-link uri">https://docs.github.com/en/actions/managing-workflow-runs/manually-running-a-workflow</a></li>
<li><a href="https://docs.github.com/en/rest/reference/actions/#create-a-workflow-dispatch-event" class="external-link uri">https://docs.github.com/en/rest/reference/actions/#create-a-workflow-dispatch-event</a></li>
</ul>
<p>Before we move on, I repeat: It is important that your
<code>main</code> branch have the latest pkgdown workflow. (Or whatever
your default branch is called.) At the time of writing, this means the
<code>v2</code> tag in <code>r-lib/actions</code>. The easiest way to
get this is to install dev usethis and run
<code>usethis::use_github_action("pkgdown")</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="construct-a-branch-for-the-update">Construct a branch for the update<a class="anchor" aria-label="anchor" href="#construct-a-branch-for-the-update"></a>
</h2>
<p>The overall goal is to create a package state from which to update
the released site that corresponds to (HEAD of) a Git branch. This
package state should:</p>
<ul>
<li>Be based on the most recent GitHub and CRAN release.</li>
<li>Incorporate all desired updates to your documentation, such as
pkgdown config.</li>
</ul>
<p>Create and checkout a branch based on the tag of the most recent CRAN
release. For example, if readr‚Äôs latest release is 2.1.1:</p>
<pre><code>git checkout -b update-pkgdown-2-1-1 v2.1.1</code></pre>
<p>And here is the general pattern:</p>
<pre><code>git checkout -b NEW-BRANCH-NAME NAME-OF-RELEASE-TAG</code></pre>
<p>Now you should backport innovations from the future that you would
like to retroactively apply to your released site.</p>
<p>Files you must update:</p>
<ul>
<li><code>.github/workflows/pkgdown.yaml</code></li>
<li><code>_pkgdown.yml</code></li>
<li>
<code>Config/Needs/website</code> field of DESCRIPTION (And,
probably, only this field! In particular, do not mess with the version
number.)</li>
</ul>
<p>Other likely candidates:</p>
<ul>
<li>
<code>README.Rmd</code> + <code>README.md</code>, e.g., if you‚Äôve
updated badges.</li>
<li>Any documentation fixes that <strong>apply to the released
version</strong>. This is the only reason to touch anything below
<code>R/</code> and even then it should only affect roxygen comments.
Don‚Äôt forget to <code>document()</code> if you do this!</li>
<li>Any new vignettes or articles that apply to the released
version.</li>
</ul>
<p>Here are some tips on backporting specific changes into this branch.
If you are lucky, there are specific commits in your default branch that
contain all the necessary changes. In that case, we can cherry pick such
a commit by its SHA:</p>
<pre><code>git cherry-pick SHA</code></pre>
<p>If that doesn‚Äôt cover everything, for each file you want to update,
identify a Git reference (meaning: a SHA, tag, or branch) where the file
is in the desired state. Checkout that specific file path from that
specific ref:</p>
<pre><code>git checkout REF -- path/to/the/file</code></pre>
<p>For example, readr recently gained a new vignette that applies to the
released version of readr, i.e.¬†it does not document any dev-only
features or functions. Here‚Äôs how to introduce the new vignette from
HEAD of <code>main</code> into the current branch:</p>
<pre><code>git checkout main -- vignettes/column-types.Rmd</code></pre>
<p>Commit and push this new branch to GitHub.
<code><a href="https://usethis.r-lib.org/reference/pull-requests.html" class="external-link">usethis::pr_push()</a></code> can be handy for this. Just don‚Äôt bother
opening a pull request (the branch will still be pushed).</p>
<p>Now we will use the <code>workflow_dispatch</code> GHA trigger. Go to
the Actions page of your repo, maybe via
<code><a href="https://usethis.r-lib.org/reference/browse-this.html" class="external-link">usethis::browse_github_actions()</a></code>. Click on the
<code>pkgdown</code> workflow.</p>
<p>You should see ‚ÄúThis workflow has a workflow_dispatch event
trigger.‚Äù<br>
(If you don‚Äôt, that means you didn‚Äôt do one of the pre-requisites, which
is to update to <code>v2</code> of the pkgdown workflow.)</p>
<p>See the ‚ÄúRun workflow‚Äù button? CLICK IT. In the ‚ÄúUse workflow from‚Äù
dropdown menu, select the branch you‚Äôve just made and pushed. This
should kick off a pkgdown build-and-deploy and, specifically, it should
cause updates to the <strong>released</strong> site.</p>
<p>You can keep this branch around for a while, in case you didn‚Äôt get
everything right the first time or if more things crop up that you‚Äôd
like backport to the released site, before your next CRAN release.</p>
</div>
<div class="section level2">
<h2 id="problem-solving">Problem-solving<a class="anchor" aria-label="anchor" href="#problem-solving"></a>
</h2>
<p>Remember GitHub search is a great way to get other people‚Äôs
<code>_pkgdown.yml</code> files in front of your eyeballs:</p>
<p>Example query: <a href="https://github.com/search?q=path%3A%22_pkgdown.yml%22+AND+%28org%3Atidyverse+OR+org%3Ar-lib%29&amp;type=code" class="external-link"><code>path:"_pkgdown.yml" AND (org:tidyverse OR org:r-lib)</code></a></p>
<p>For any given <code>_pkgdown.yml</code> file on GitHub, remember that
its History and Blame can be helpful for seeing how another package‚Äôs
config has evolved over time.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://hesselberthlab.org" class="external-link">Jay Hesselberth</a>, <a href="https://masalmon.eu" class="external-link">Ma√´lle Salmon</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
